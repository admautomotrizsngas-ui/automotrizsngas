<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiencias de Clientes - SN'GAS</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
        header { background: #222; color: #fff; padding: 20px 0; text-align: center; }
        .container { max-width: 900px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1, h2 { color: #009688; }
        .post {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.07);
            padding: 14px 12px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
            margin-bottom: 18px;
        }
        .post img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            border: 1.5px solid #25d366;
        }
        .post .info { flex: 1; }
        .post .nombre { font-weight: bold; color: #009688; }
        .post .texto { margin: 7px 0 0 0; }
        .post .fecha { font-size: 0.9em; color: #aaa; margin-top: 6px; }
        @media (max-width: 700px) {
            .container { padding: 10px; margin: 10px; }
            .post { flex-direction: column; align-items: flex-start; }
            .post img { width: 100%; height: auto; max-width: 220px; }
        }
        a.volver { display:inline-block; margin-bottom:18px; color:#009688; text-decoration:none; font-weight:bold; }
        form { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        form input, form button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
        form button {
            background: #25d366;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        form button:hover {
            background: #219558;
        }
    </style>
</head>
<body>
    <header>
        <h1>Experiencias de Clientes</h1>
        <a href="index.html" class="volver">&larr; Volver a la p√°gina principal</a>
    </header>
    <div class="container">
        <h2>Publicaciones recientes</h2>
        <form id="form-experiencia" style="background:#f8f8f8;padding:18px 12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.06);margin-bottom:24px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
            <input type="text" id="nombre-cliente" placeholder="Tu nombre" required style="flex:1 1 120px;padding:7px 8px;border-radius:6px;border:1px solid #ccc;">
            <input type="file" id="foto-cliente" accept="image/*" style="flex:1 1 180px;">
            <input type="text" id="texto-experiencia" placeholder="Escribe tu experiencia..." required style="flex:2 1 220px;padding:7px 8px;border-radius:6px;border:1px solid #ccc;">
            <button type="submit" style="background:#25d366;color:#fff;padding:8px 18px;border:none;border-radius:6px;font-size:1em;">Publicar</button>
        </form>
        <div id="muro-experiencias"></div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
    // PASO 2: Configura tu proyecto Firebase aqu√≠
    const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "TU_AUTH_DOMAIN",
        databaseURL: "TU_DATABASE_URL",
        projectId: "TU_PROJECT_ID",
        storageBucket: "TU_STORAGE_BUCKET",
        messagingSenderId: "TU_MESSAGING_SENDER_ID",
        appId: "TU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function fileToBase64(file, cb) {
        const reader = new FileReader();
        reader.onload = e => cb(e.target.result);
        reader.readAsDataURL(file);
    }

    document.getElementById('form-experiencia').onsubmit = function(e) {
        e.preventDefault();
        const nombre = document.getElementById('nombre-cliente').value.trim();
        const texto = document.getElementById('texto-experiencia').value.trim();
        const fotoInput = document.getElementById('foto-cliente');
        const fecha = new Date().toLocaleString('es-PE', {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
        if(!texto) return;
        const post = {nombre,texto,fecha,foto:'',likes:0,dislikes:0,respuestas:[]};
        if(fotoInput.files && fotoInput.files[0]) {
            fileToBase64(fotoInput.files[0], function(base64){
                post.foto = base64;
                db.ref('experiencias').push(post);
            });
        } else {
            db.ref('experiencias').push(post);
        }
        this.reset();
    };

    db.ref('experiencias').on('value', function(snapshot){
        const muro = document.getElementById('muro-experiencias');
        const posts = [];
        snapshot.forEach(child => {
            posts.push({...child.val(), _id: child.key});
        });
        muro.innerHTML = '';
        if(posts.length===0) {
            muro.innerHTML = '<div style="color:#888;text-align:center;">A√∫n no hay experiencias publicadas.</div>';
        } else {
            posts.reverse().forEach(function(post,idx){
                let likes = post.likes || 0;
                let dislikes = post.dislikes || 0;
                let respuestas = post.respuestas || [];
                muro.innerHTML += `<div class=\"post\">
                    ${post.foto?`<img src=\"${post.foto}\" alt=\"Foto cliente\">`:''}
                    <div class=\"info\">
                        <div class=\"nombre\">${post.nombre||'An√≥nimo'}</div>
                        <div class=\"texto\">${post.texto}</div>
                        <div class=\"fecha\">${post.fecha}</div>
                        <div class=\"acciones\">
                            <button class=\"like\" onclick=\"meGusta('${post._id}')\">üëç <span id='like-${post._id}'>${likes}</span></button>
                            <button class=\"dislike\" onclick=\"noMeGusta('${post._id}')\">üëé <span id='dislike-${post._id}'>${dislikes}</span></button>
                            <button class=\"responder\" onclick=\"mostrarResponder('${post._id}')\">Responder</button>
                        </div>
                        <div id=\"responder-${post._id}\" style=\"display:none;margin-top:8px;\">
                            <input type=\"text\" id=\"input-respuesta-${post._id}\" placeholder=\"Escribe una respuesta...\" style=\"padding:5px 8px;border-radius:5px;border:1px solid #ccc;width:70%;\">
                            <button onclick=\"publicarRespuesta('${post._id}')\" style=\"background:#25d366;color:#fff;padding:5px 12px;border:none;border-radius:5px;\">Publicar</button>
                        </div>
                        <div class=\"respuestas\" id=\"respuestas-${post._id}\">
                            ${respuestas.map(r=>`<div class=\"respuesta\"><b>${r.nombre||'An√≥nimo'}:</b> ${r.texto}</div>`).join('')}
                        </div>
                    </div>
                </div>`;
            });
        }
    });

    function meGusta(id) {
        const ref = db.ref('experiencias/'+id+'/likes');
        ref.transaction(likes => (likes||0)+1);
    }
    function noMeGusta(id) {
        const ref = db.ref('experiencias/'+id+'/dislikes');
        ref.transaction(dislikes => (dislikes||0)+1);
    }
    function mostrarResponder(id) {
        let el = document.getElementById('responder-'+id);
        if(el) el.style.display = (el.style.display==='none')?'block':'none';
    }
    function publicarRespuesta(id) {
        let input = document.getElementById('input-respuesta-'+id);
        let texto = input.value.trim();
        if(!texto) return;
        let nombre = prompt('¬øTu nombre? (opcional)','');
        db.ref('experiencias/'+id+'/respuestas').once('value', snap => {
            let respuestas = snap.val()||[];
            respuestas.push({nombre,texto});
            db.ref('experiencias/'+id+'/respuestas').set(respuestas);
        });
        input.value = '';
    }
    </script>
</body>
</html>
